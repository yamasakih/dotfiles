# Claude コマンド: Pull Request

このコマンドは、現在のブランチの変更内容を分析して、適切にフォーマットされたプルリクエストの作成を支援します。

## 使用方法

プルリクエストを作成するには次のように入力してください

```
/pr
```

## このコマンドは以下の手順を実行します

1. 現在のブランチが`main`または`master`でないことを確認します
2. `main`または`master`ブランチの場合、適切なフィーチャーブランチに切り替えるよう警告します
3. `git status`で現在の変更状況を確認します
4. `git log main..HEAD`で現在のブランチのコミット履歴を取得します
5. `git diff main...HEAD`で main ブランチとの差分を分析します
6. リモートブランチの状態を確認し、必要に応じて`git push`を実行します
7. コミット履歴と変更内容を分析して PR タイトルと説明を作成します
8. `claude`ラベルが存在するか確認し、存在しない場合は新規作成する
   - `gh label list` でラベル一覧を確認
   - `claude`ラベルが存在しない場合は `gh label create "claude" --color "0052cc" --description "Created by Claude AI"` で作成
9. `gh pr create`コマンドを使用してプルリクエストを作成します

## 重要な注意事項

- プルリクエスト作成前に、すべての変更がコミットされていることを確認してください
- リモートブランチが存在しない場合、自動的に`git push -u origin <branch-name>`を実行します
- PR の説明は変更内容とコミット履歴に基づいて自動生成されます
- 必要に応じて PR にラベルやレビュアーを自動的に設定します
- Draft PR として作成するかどうかも変更内容に基づいて判定します

## PR タイトルとボディのフォーマット

### タイトル形式

```
<emoji> <type>: <短い説明>
```

### ボディ形式

```
## Summary
<変更内容の概要を箇条書きで3つ以内>

## Changes
<主要な変更点の詳細>

## Test plan
<テスト計画またはテスト方法>

## Additional notes
<追加の注意事項があれば記載>
```

## PR タイプと Emoji 対応

- `feat`: ✨ - 新機能
- `fix`: 🐛 - バグ修正
- `docs`: 📝 - ドキュメント変更
- `style`: 💄 - コードスタイル変更
- `refactor`: ♻️ - リファクタリング
- `perf`: ⚡️ - パフォーマンス改善
- `test`: ✅ - テスト追加・修正
- `chore`: 🔧 - ツール・設定変更

## 例

良い PR タイトル例：

- ✨ feat: ユーザー認証機能を追加
- 🐛 fix: API 応答タイムアウトエラーを修正
- 📝 docs: セットアップガイドを更新
- ♻️ refactor: データベース接続処理を改善
- 🔧 chore: CI/CD パイプラインを最適化

PR ボディの例：

```markdown
## Summary

- JWT 認証を使用したユーザーログイン機能を実装
- ログイン状態の永続化機能を追加
- セキュリティヘッダーの設定を強化

## Changes

- `auth/` ディレクトリに認証関連のコンポーネントを追加
- JWT トークンの生成・検証ロジックを実装
- ユーザーセッション管理のための Redis 統合
- 認証ミドルウェアを API ルートに適用

## Test plan

- [ ] ユニットテスト: 認証ロジックの各関数をテスト
- [ ] 統合テスト: ログイン/ログアウトフローをテスト
- [ ] E2E テスト: ブラウザでの実際のユーザー操作をテスト
- [ ] セキュリティテスト: 不正アクセス試行のテスト

## Additional notes

- 本番環境での JWT 秘密鍵の設定が必要
- Redis サーバーの設定確認が必要
```
