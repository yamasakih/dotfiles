# å°‘ã—å‡ã£ãŸ zshrc
# License : MIT
# http://mollifier.mit-license.org/

########################################
# ç’°å¢ƒå¤‰æ•°
export LANG=en_US.UTF-8
export LANGUAGE=en_US.UTF-8
export LC_ALL=en_US.UTF-8

# è‰²ã‚’ä½¿ç”¨å‡ºæ¥ã‚‹ã‚ˆã†ã«ã™ã‚‹
autoload -Uz colors
colors

# emacs é¢¨ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰ã«ã™ã‚‹
bindkey -e

# ãƒ’ã‚¹ãƒˆãƒªã®è¨­å®š
HISTFILE=~/.zsh_history
HISTSIZE=1000000
SAVEHIST=1000000

# ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
# 1è¡Œè¡¨ç¤º
# PROMPT="%~ %# "
# 2è¡Œè¡¨ç¤º
PROMPT="%{${fg[green]}%}[%n@%m]%{${reset_color}%} %~
%# "


# å˜èªã®åŒºåˆ‡ã‚Šæ–‡å­—ã‚’æŒ‡å®šã™ã‚‹
autoload -Uz select-word-style
select-word-style default
# ã“ã“ã§æŒ‡å®šã—ãŸæ–‡å­—ã¯å˜èªåŒºåˆ‡ã‚Šã¨ã¿ãªã•ã‚Œã‚‹
# / ã‚‚åŒºåˆ‡ã‚Šã¨æ‰±ã†ã®ã§ã€^W ã§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‘ã¤åˆ†ã‚’å‰Šé™¤ã§ãã‚‹
zstyle ':zle:*' word-chars " /=;@:{},|"
zstyle ':zle:*' word-style unspecified

# Add fpath
fpath+=~/.zfunc
fpath=(~/.zsh/completion $fpath)

########################################
# è£œå®Œ
# è£œå®Œæ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã™ã‚‹
autoload bashcompinit && bashcompinit
autoload -Uz compinit && compinit -i
compinit

# è£œå®Œã§å°æ–‡å­—ã§ã‚‚å¤§æ–‡å­—ã«ãƒãƒƒãƒã•ã›ã‚‹
zstyle ':completion:*' matcher-list 'm:{a-z}={A-Z}'

# ../ ã®å¾Œã¯ä»Šã„ã‚‹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è£œå®Œã—ãªã„
zstyle ':completion:*' ignore-parents parent pwd ..

# sudo ã®å¾Œã‚ã§ã‚³ãƒãƒ³ãƒ‰åã‚’è£œå®Œã™ã‚‹
zstyle ':completion:*:sudo:*' command-path /usr/local/sbin /usr/local/bin \
                   /usr/sbin /usr/bin /sbin /bin /usr/X11R6/bin

# ã‚ªãƒ—ã‚·ãƒ§ãƒ³
# æ—¥æœ¬èªãƒ•ã‚¡ã‚¤ãƒ«åã‚’è¡¨ç¤ºå¯èƒ½ã«ã™ã‚‹
setopt print_eight_bit

# beep ã‚’ç„¡åŠ¹ã«ã™ã‚‹
setopt no_beep

# ãƒ•ãƒ­ãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’ç„¡åŠ¹ã«ã™ã‚‹
setopt no_flow_control

# Ctrl+Dã§zshã‚’çµ‚äº†ã—ãªã„
setopt ignore_eof

# '#' ä»¥é™ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦æ‰±ã†
setopt interactive_comments

# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåã ã‘ã§cdã™ã‚‹
setopt auto_cd

# cd ã—ãŸã‚‰è‡ªå‹•çš„ã«pushdã™ã‚‹
setopt auto_pushd
# é‡è¤‡ã—ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¿½åŠ ã—ãªã„
setopt pushd_ignore_dups

# åŒæ™‚ã«èµ·å‹•ã—ãŸzshã®é–“ã§ãƒ’ã‚¹ãƒˆãƒªã‚’å…±æœ‰ã™ã‚‹
setopt share_history

# åŒã˜ã‚³ãƒãƒ³ãƒ‰ã‚’ãƒ’ã‚¹ãƒˆãƒªã«æ®‹ã•ãªã„
setopt hist_ignore_all_dups

# ã‚¹ãƒšãƒ¼ã‚¹ã‹ã‚‰å§‹ã¾ã‚‹ã‚³ãƒãƒ³ãƒ‰è¡Œã¯ãƒ’ã‚¹ãƒˆãƒªã«æ®‹ã•ãªã„
setopt hist_ignore_space

# ãƒ’ã‚¹ãƒˆãƒªã«ä¿å­˜ã™ã‚‹ã¨ãã«ä½™åˆ†ãªã‚¹ãƒšãƒ¼ã‚¹ã‚’å‰Šé™¤ã™ã‚‹
setopt hist_reduce_blanks

# é«˜æ©Ÿèƒ½ãªãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰å±•é–‹ã‚’ä½¿ç”¨ã™ã‚‹
setopt extended_glob

########################################
# ã‚­ãƒ¼ãƒã‚¤ãƒ³ãƒ‰

# ^R ã§å±¥æ­´æ¤œç´¢ã‚’ã™ã‚‹ã¨ãã« * ã§ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ã‚’ä½¿ç”¨å‡ºæ¥ã‚‹ã‚ˆã†ã«ã™ã‚‹
bindkey '^R' history-incremental-pattern-search-backward

########################################
# ã‚¨ã‚¤ãƒªã‚¢ã‚¹

alias la='ls -a'
alias ll='ls -l'

alias rm='rm -i'
alias cp='cp -i'
alias mv='mv -i'

alias mkdir='mkdir -p'

alias cat='bat'

# sudo ã®å¾Œã®ã‚³ãƒãƒ³ãƒ‰ã§ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã‚’æœ‰åŠ¹ã«ã™ã‚‹
alias sudo='sudo '

# ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ã‚¤ãƒªã‚¢ã‚¹
alias -g L='| less'
alias -g G='| grep'

# C ã§æ¨™æº–å‡ºåŠ›ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹
# mollifier delta blog : http://mollifier.hatenablog.com/entry/20100317/p1
if which pbcopy >/dev/null 2>&1 ; then
    # Mac
    alias -g C='| pbcopy'
elif which xsel >/dev/null 2>&1 ; then
    # Linux
    alias -g C='| xsel --input --clipboard'
elif which putclip >/dev/null 2>&1 ; then
    # Cygwin
    alias -g C='| putclip'
fi

########################################
# OS åˆ¥ã®è¨­å®š
case ${OSTYPE} in
    darwin*)
        #Macç”¨ã®è¨­å®š
        export CLICOLOR=1
        alias ls='ls -G -F'
        ;;
    linux*)
        #Linuxç”¨ã®è¨­å®š
        alias ls='ls -F --color=auto'
        ;;
esac

# vim:set ft=zsh:

# Add fzf configuration
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh

# Add gamess gms command
export PATH="/Applications/gamess:$PATH"

# Add devcontainer configuration
if [ -z "$SSH_AUTH_SOCK" ]; then
   # Check for a currently running instance of the agent
   RUNNING_AGENT="`ps -ax | grep 'ssh-agent -s' | grep -v grep | wc -l | tr -d '[:space:]'`"
   if [ "$RUNNING_AGENT" = "0" ]; then
        # Launch a new instance of the agent
        ssh-agent -s &> $HOME/.ssh/ssh-agent
   fi
   eval `cat $HOME/.ssh/ssh-agent`
fi

# Add bash_completion command configuration
complete -C '/usr/local/bin/aws_completer' aws

# Add AWS profile
export AWS_PROFILE=default
export ACCOUNT_ID=
export ECR_ADDRESS=${ACCOUNT_ID}.dkr.ecr.ap-northeast-1.amazonaws.com

# Add zsh-autosuggestions
source ~/.zsh/zsh-autosuggestions/zsh-autosuggestions.zsh
ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE='fg=5'

# ADD PYTEST_ADDOPTS
export PYTEST_ADDOPTS='-v --disable-warnings --ff'

# Add luigi configuration
export LUIGI_CONFIG_PARSER=ini
export LUIGI_CONFIG_PATH=.

# Add gh completion
gh -version &> /dev/null
if [ $? -eq 0 ] ; then
  eval "$(gh completion -s zsh)"
fi

# Add path to cargo
if [ -e ~/.cargo/env ] ; then
  source ~/.cargo/env
fi

# Add gcd (cd to git repository root)
function gcd() {
  cd `git rev-parse --show-toplevel`
}

command -v starship &>/dev/null && eval "$(starship init zsh)"

alias y='yazi'
export PATH="$HOME/.local/bin:$PATH"

command -v git-wt &>/dev/null && eval "$(git wt --init zsh)"

{{ if eq .chezmoi.hostname "HiroyukinoMacBook-Pro" }}
alias dy='gcloud compute ssh --zone "asia-northeast1-a" "dev-yamasaki" --tunnel-through-iap --project "ai-lab-drawer-ml-dev" --ssh-flag="-A"'
alias ccc='gcloud compute ssh --zone "asia-northeast1-a" "dev-yamasaki" --tunnel-through-iap --project "ai-lab-drawer-ml-dev" -- -N -R 127.0.0.1:18080:127.0.0.1:18080 &'
gssh-ports() {
    local instance="dev-yamasaki"
    local zone="asia-northeast1-a"
    local project="ai-lab-drawer-ml-dev"
    local port_args=()

    # ç¬¬1å¼•æ•°ãŒã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åã‹åˆ¤å®š
    if [[ -n "$1" && ! "$1" =~ ^[0-9]+$ ]]; then
        instance="$1"
        shift
    fi

    # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒãƒ¼ãƒˆè¨­å®š
    if [ $# -eq 0 ]; then
        set -- 8001
    fi

    # ãƒãƒ¼ãƒˆå¼•æ•°ã®æ§‹ç¯‰
    for port in "$@"; do
        port_args+=("-L" "${port}:127.0.0.1:${port}")
    done

    # --- 1. ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®çŠ¶æ…‹ç¢ºèªã¨èµ·å‹• ---
    echo "Checking status of $instance..."
    # å¤‰æ•°åã‚’ vm_status ã«å¤‰æ›´ã—ã¦ç«¶åˆã‚’å›é¿
    local vm_status=$(gcloud compute instances describe "$instance" \
        --project "$project" --zone "$zone" \
        --format='get(status)' 2>/dev/null)

    if [ "$vm_status" != "RUNNING" ]; then
        echo "Instance $instance is currently $vm_status. Starting it now..."
        gcloud compute instances start "$instance" --project "$project" --zone "$zone"
    else
        echo "Instance is already running."
    fi

    # --- 2. æ¥ç¶šã¨URLã®è¡¨ç¤º ---
    local first_port="$1"
    echo "---------------------------------------------------"
    echo "ğŸš€ Connecting to $instance..."
    echo "ğŸ”— Local URL: http://localhost:$first_port"
    echo "---------------------------------------------------"

    # SSHæ¥ç¶šï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å®Ÿè¡Œï¼‰
    gcloud compute ssh "$instance" \
        --zone "$zone" \
        --project "$project" \
        --tunnel-through-iap \
        -- -N "${port_args[@]}" &
}
# SSH å…ˆã§ Warning ãŒå‡ºãªã„ã‚ˆã†ã«ã™ã‚‹
export CLOUDSDK_PYTHON_SITEPACKAGES=1
{{ end }}

# bun completions
[ -s "/home/hiroyuki_yamasaki_caddi_jp/.bun/_bun" ] && source "/home/hiroyuki_yamasaki_caddi_jp/.bun/_bun"

# bun
export BUN_INSTALL="$HOME/.bun"
export PATH="$BUN_INSTALL/bin:$PATH"

alias docker-compose='docker compose'
alias yg='ygrep'
alias dc='docker compose'

# git-wt
eval "$(git wt --init zsh)"
alias wjg='cd $(git wt | fzf --header-lines=1 | awk "{if (\$1 == \"*\") print \$2; else print \$1}")'

{{ if eq .chezmoi.os "linux" }}
# --- ä»¥ä¸‹ã®è¨­å®šã¯ Ubuntu ç’°å¢ƒã«ã®ã¿å±•é–‹ã•ã‚Œã¾ã™ ---
# VM ä¸Šã§ã®æ–‡å­—ã®ãšã‚Œã‚’é˜²ã
export TERM=xterm-256color

# Linuxbrew
eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
export PATH="$HOME/.local/bin:$PATH"

# CLAUDE CODE
export ENABLE_EXPERIMENTAL_MCP_CLI=false
export ENABLE_TOOL_SEARCH=true
{{ end }}

# yazi ã‚’ y ã§é–‹ã&ç§»å‹•ã—ãŸãƒ•ã‚©ãƒ«ãƒ€ã« yazi ã‚’é–‰ã˜ãŸå¾Œã‚‚ç§»å‹•ã—ã¦ã„ã‚‹
function y() {
    local tmp="$(mktemp -t "yazi-cwd.XXXXXX")"
    yazi "$@" --cwd-file="$tmp"
    if cwd="$(cat -- "$tmp")" && [ -n "$cwd" ] && [ "$cwd" != "$PWD" ]; then
             builtin cd -- "$cwd"
    fi
    rm -f -- "$tmp"
}

# zoxide
# ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãŒå¯¾è©±æ“ä½œï¼ˆInteractiveï¼‰ã®æ™‚ã ã‘ cd ã‚’ä¸Šæ›¸ãã™ã‚‹
if [[ $- == *i* ]]; then
    eval "$(zoxide init zsh --cmd cd)"
fi

